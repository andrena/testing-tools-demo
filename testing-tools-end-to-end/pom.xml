<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>de.andrena.testing.tools</groupId>
		<artifactId>testing-tools-parent</artifactId>
		<version>1.0-SNAPSHOT</version>
	</parent>

	<artifactId>testing-tools-end-to-end</artifactId>

	<build>
		<resources>
			<resource>
				<directory>src/main/scripts</directory>
				<filtering>true</filtering>
				<includes>
					<include>**/*.yml</include>
				</includes>
				<excludes>
					<exclude>**/*.sh</exclude>
				</excludes>
				<targetPath>${project.build.directory}/scripts</targetPath>
			</resource>
			<resource>
				<directory>src/main/scripts</directory>
				<filtering>false</filtering>
				<includes>
					<include>**/*.sh</include>
				</includes>
				<excludes>
					<exclude>**/*.yml</exclude>
				</excludes>
				<targetPath>${project.build.directory}/scripts</targetPath>
			</resource>
		</resources>
		<testResources>
			<testResource>
				<directory>src/test/resources</directory>
				<filtering>true</filtering>
				<includes>
					<include>**/*.properties</include>
					<include>**/*.feature</include>
				</includes>
			</testResource>
		</testResources>

		<plugins>
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<configuration>
					<skip>true</skip>
				</configuration>
			</plugin>
		</plugins>
	</build>

	<profiles>
		<profile>
			<id>docker-environment</id>

			<properties>
				<script.work.dir>${basedir}/target/scripts</script.work.dir>
			</properties>

			<build>
				<plugins>
					<plugin>
						<groupId>io.fabric8</groupId>
  						<artifactId>docker-maven-plugin</artifactId>
						<configuration>
							<autoPull>true</autoPull>
							<images>
								<image>
									<alias>chrome</alias>
									<name>selenium/standalone-chrome-debug:${selenium.version}</name>
									<run>
										<ports>
											<port>4444:4444</port>
										</ports>
										<wait>
											<time>2000</time>
										</wait>
										<network>
											<mode>custom</mode>
   											<name>scripts_default</name>
										</network>
									</run>
								</image>
							</images>
						</configuration>
						<executions>
							<execution>
								<id>run-docker</id>
								<phase>pre-integration-test</phase>
								<goals>
									<goal>start</goal>
								</goals>
							</execution>
							<execution>
								<id>stop-docker</id>
								<phase>post-integration-test</phase>
								<goals>
									<goal>stop</goal>
								</goals>
							</execution>
						</executions>
					</plugin>

					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>exec-maven-plugin</artifactId>
						<configuration>
							<workingDirectory>${script.work.dir}</workingDirectory>
						</configuration>
						<executions>
							 <execution>
			                    <id>script-chmod</id>
			                    <phase>pre-integration-test</phase>
			                    <goals>
			                        <goal>exec</goal>
			                    </goals>
			                    <configuration>
			                        <executable>chmod</executable>
			                        <arguments>
			                            <argument>+x</argument>
			                            <argument>startup.sh</argument>
			                            <argument>shutdown.sh</argument>
			                            <argument>clean_docker_vm.sh</argument>
			                        </arguments>
			                    </configuration>
			                </execution>
							<execution>
								<id>start-app</id>
								<phase>pre-integration-test</phase>
								<goals>
									<goal>exec</goal>
								</goals>
								<configuration>
									<executable>${script.work.dir}/startup.sh</executable>
								</configuration>
							</execution>
							<execution>
								<id>stop-app</id>
								<phase>post-integration-test</phase>
								<goals>
									<goal>exec</goal>
								</goals>
								<configuration>
									<executable>${script.work.dir}/shutdown.sh</executable>
								</configuration>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<artifactId>maven-failsafe-plugin</artifactId>
						<executions>
							<execution>
								<id>integration-tests</id>
								<goals>
									<goal>integration-test</goal>
								</goals>
								<phase>integration-test</phase>
								<configuration>
									<includes>
										<include>**/*IntegrationTest.*</include>
									</includes>
								</configuration>
							</execution>
							<execution>
								<id>verify-integration-tests</id>
								<goals>
									<goal>verify</goal>
								</goals>
								<phase>post-integration-test</phase>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>

	<dependencies>
		<dependency>
			<groupId>org.seleniumhq.selenium</groupId>
			<artifactId>selenium-java</artifactId>
		</dependency>
		<dependency>
			<groupId>org.seleniumhq.selenium</groupId>
			<artifactId>selenium-remote-driver</artifactId>
		</dependency>
		<dependency>
		    <groupId>info.cukes</groupId>
		    <artifactId>cucumber-junit</artifactId>
		</dependency>
		<dependency>
		    <groupId>info.cukes</groupId>
		    <artifactId>cucumber-java</artifactId>
		</dependency>
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
		</dependency>
		<dependency>
			<groupId>org.hamcrest</groupId>
			<artifactId>hamcrest-all</artifactId>
		</dependency>
	</dependencies>

</project>